var h=Object.create;var n=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,c=Object.prototype.hasOwnProperty;var o=e=>n(e,"__esModule",{value:!0});var b=(e,s)=>{for(var t in s)n(e,t,{get:s[t],enumerable:!0})},l=(e,s,t,i)=>{if(s&&typeof s=="object"||typeof s=="function")for(let r of p(s))!c.call(e,r)&&(t||r!=="default")&&n(e,r,{get:()=>s[r],enumerable:!(i=v(s,r))||i.enumerable});return e},k=(e,s)=>l(o(n(e!=null?h(m(e)):{},"default",!s&&e&&e.__esModule?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e),w=(e=>(s,t)=>e&&e.get(s)||(t=l(o({}),s,1),e&&e.set(s,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var E={};b(E,{Pool:()=>u,default:()=>d});var a=k(require("events")),u=class extends a.default{constructor(s=1){super();this.size=s,this.available=s,this.tasks=[],this.queue=[],this.resolves=[],this.results=[]}on(s,t){return super.on(s,t),this}once(s,t){return super.once(s,t),this}removeListener(s,t){return super.removeListener(s,t),this}removeAllListeners(s){return super.removeAllListeners(s),this}emit(s,...t){return super.emit(s,...t)}push(s){this.tasks.push(async()=>s())}async go(){this.emit("pool-start"),this.available=this.size,this.queue=[],this.resolves=[],this.results=[];for(let s=0;s<this.tasks.length;s++)await this.isAvailable(),this.queue.push((async()=>{var t;this.emit("task-start",s);try{let i=await this.tasks[s]();this.results[s]=i,this.resolves.length>0&&((t=this.resolves.shift())==null||t(!0)),this.emit("task-finish",s,i)}catch(i){this.emit("task-error",s,i)}})());return await Promise.all(this.queue),this.queue=[],this.emit("pool-end"),this.results}run(){return this.go()}isAvailable(){return new Promise(s=>{this.available>0?(this.available--,s(!0)):this.resolves.push(s)})}},d=u;module.exports=w(E);0&&(module.exports={Pool});
